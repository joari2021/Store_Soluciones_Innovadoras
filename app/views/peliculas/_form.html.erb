<%= turbo_frame_tag "modal-peliculas" do%>
  <div class="main" style="width: 500px !important">
    <%= form_with(model: pelicula, local: false, data: { visit: @editing }, id: "form-peliculas") do |form| %>
      <% if pelicula.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(pelicula.errors.count, "error") %> prohibited this pelicula from being saved:</h2>
          <ul>
            <% pelicula.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <div class="mb-3">
        <%= form.label :poster, "Poster Pelicula", class: "form-label" %>
        <%= form.file_field :poster, class:"form-control form-control-sm" %>
      </div>
      <div class="mb-3">
        <%= form.label :name, "Titulo", class: "form-label" %>
        <%= form.text_field :name, class:"form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :others_titles, "Otros Titulos", class: "form-label" %>
        <%= form.text_field :others_titles, class:"form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :date_estreno, "Fecha de Estreno" %>
        <div class="form-row">
          <%= form.date_select :date_estreno, { order: [:day, :month, :year], prompt: { day: 'Día', month: 'Mes', year: 'Año' }, start_year: Date.today.year, end_year: 1900 }, class: "form-control-inline custom-date-select" %>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-6">
          <%= form.label :duration_hours, "Horas de Duración", class: "form-label" %>
          <%= form.number_field :duration_hours, class: "form-control" %>
        </div>
        <div class="col-6">
          <%= form.label :duration_minutes, "Minutos de Duración", class: "form-label" %>
          <%= form.number_field :duration_minutes, class: "form-control" %>
        </div>
      </div>
      <div class="mb-3">
        <%= form.label :link_trailer, "Link del Trailer", class: "form-label" %>
        <%= form.text_field :link_trailer, class:"form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :director, "Director", class: "form-label" %>
        <%= form.text_field :director, class:"form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :reparto, "Reparto", class: "form-label" %>
        <%= form.text_field :reparto, class:"form-control" %>
      </div>
      <div class="mb-3">
        <%= form.label :audio, "Audio", class: "form-label" %>
        <%= form.select :audio, options_for_select([["Español Latino", "español latino"], ["Castellano", "castellano"], ["Ingles", "ingles"], ["Japones", "japones"]], @pelicula.audio), {}, class: "form-select" %>
      </div>
      <div class="mb-3">
        <%= form.label :sinopsis, "Sinopsis", class:"form-label" %>
        <%= form.text_area :sinopsis, class:"form-control", rows: 10 %>
      </div>
      <h3>Puntuaciones</h3>
      <div id="rankings">
        <%= form.fields_for :rankings do |pf| %>
          <%= render "ranking_fields", pf: pf%>
        <% end %>
      </div>
      <%= link_to_add_fields "Add Puntuacion", form, :rankings %>
      <hr>
      <div class="mb-2">
        <span>Generos:</span>
        <br>
        <br>
        <div class="row mb-3">
          <%= form.collection_check_boxes(:genero_ids, Genero.all, :id, :name) do |b| %>
            <div class="collection-check-box mb-1 col-6">
              <%= b.check_box(class: "form-check-input") %>
              <%= b.label(class: "form-check-label") %>
            </div>
          <% end %>
        </div>
      </div>
      <div class="actions">
        <%= form.submit "Guardar", class: "btn btn-info" %>
      </div>
    <% end %>
  </div>
<%end%>
<script>
  document.querySelectorAll('.add_fields').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      let time = new Date().getTime();
      let link = this;
      let regexp = new RegExp(link.dataset.id, 'g');
      document.querySelector('#rankings').insertAdjacentHTML('beforeend', link.dataset.fields.replace(regexp, time));
    });
  });

  document.querySelectorAll(".remove_fields").forEach(function(button) {
    button.addEventListener("click", function(event) {
      event.preventDefault();
      let field = event.target.closest(".field");
      field.querySelector("input[type='hidden']").value = "1";
      field.style.display = "none";

    });
  });
</script>
